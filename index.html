<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Analysis of Eye Data • eye</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Analysis of Eye Data">
<meta name="description" content="There is no ophthalmic researcher who has not had headaches from the handling of visual acuity entries. Different notations, untidy entries. This shall now be a matter of the past. Eye makes it as easy as pie to work with VA data - easy cleaning, easy conversion between Snellen, logMAR, ETDRS letters, and qualitative visual acuity shall never pester you again. The eye package automates the pesky task to count number of patients and eyes, and can help to clean data with easy re-coding for right and left eyes. It also contains functions to help reshaping eye side specific variables between wide and long format. Visual acuity conversion is based on Schulze-Bonsel et al. (2006) &lt;doi:10.1167/iovs.05-0981&gt;, Gregori et al. (2010) &lt;doi:10.1097/iae.0b013e3181d87e04&gt;, Beck et al. (2003) &lt;doi:10.1016/s0002-9394(02)01825-1&gt; and Bach (2007) &lt;https://michaelbach.de/sci/acuity.html&gt;.">
<meta property="og:description" content="There is no ophthalmic researcher who has not had headaches from the handling of visual acuity entries. Different notations, untidy entries. This shall now be a matter of the past. Eye makes it as easy as pie to work with VA data - easy cleaning, easy conversion between Snellen, logMAR, ETDRS letters, and qualitative visual acuity shall never pester you again. The eye package automates the pesky task to count number of patients and eyes, and can help to clean data with easy re-coding for right and left eyes. It also contains functions to help reshaping eye side specific variables between wide and long format. Visual acuity conversion is based on Schulze-Bonsel et al. (2006) &lt;doi:10.1167/iovs.05-0981&gt;, Gregori et al. (2010) &lt;doi:10.1097/iae.0b013e3181d87e04&gt;, Beck et al. (2003) &lt;doi:10.1016/s0002-9394(02)01825-1&gt; and Bach (2007) &lt;https://michaelbach.de/sci/acuity.html&gt;.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">eye</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="articles/eye.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="nav-link" href="https://github.com/tjebo/eye/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="eye">eye<a class="anchor" aria-label="anchor" href="#eye"></a>
</h1></div>
<!-- README.md is generated from README.Rmd. Please edit that file -->
<!-- badges: start -->

<p>See more with <em>eye</em></p>
<div class="section level2">
<h2 id="purpose">Purpose<a class="anchor" aria-label="anchor" href="#purpose"></a>
</h2>
<p><em>eye</em> is dedicated to facilitate very common tasks in ophthalmic research.</p>
</div>
<div class="section level2">
<h2 id="features">Features<a class="anchor" aria-label="anchor" href="#features"></a>
</h2>
<ul>
<li><a href="#visual-acuity">Handling of visual acuity notations</a></li>
<li>
<a href="#count-subjects-and-eyes">Super easy count of subjects and eyes</a>, with smooth integration in your rmarkdown report</li>
<li><a href="#recoding-the-eye-variable">Recode your eye variable</a></li>
<li>Reshape your eye data - <a href="#myop">long</a> or <a href="#hyperop">wide</a>
</li>
<li><a href="#blink">Quick summary of your eye data</a></li>
<li><a href="#reveal">Get common summary statistics</a></li>
<li><a href="#getage">Calculate age</a></li>
<li><a href="#clean-na-entries">Clean NA equivalent entries</a></li>
</ul>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install eye <a href="https://CRAN.R-project.org/package=eye" class="external-link">from CRAN</a> using <code>install.packages("eye")</code></p>
<p>Or you can install the development version from github:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co"># install.packages("devtools")</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"tjebo/eye"</span>)</span></code></pre></div>
<p>I recommend to also get <a href="https://github.com/tjebo/eyedata/">eyedata</a>, a package collating open source ophthalmic data sets.</p>
</div>
<div class="section level2">
<h2 id="details-and-examples">Details and examples<a class="anchor" aria-label="anchor" href="#details-and-examples"></a>
</h2>
<div class="section level3">
<h3 id="visual-acuity">Visual acuity<a class="anchor" aria-label="anchor" href="#visual-acuity"></a>
</h3>
<p>Pesky visual acuity notations are now a matter of the past. Convert between any of Snellen (meter/ feet/ decimal!), logMAR and ETDRS. The notation will be detected automatically and converted to the desired notation. For some more details see <a href="#va-conversion">VA conversion</a>. For entries with mixed notation, use <code>va_mixed</code> instead.</p>
<p>You can also decide to simply “clean” your VA vector with <code>va(x)</code>. This will remove all entries that are certainly no VA.</p>
<div class="section level4">
<h4 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a>
</h4>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">23</span>, <span class="fl">56</span>, <span class="fl">74</span>, <span class="fl">58</span><span class="op">)</span> <span class="co">## ETDRS letters</span></span>
<span><span class="fu"><a href="reference/VAwrapper.html">to_logmar</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="co"># wrapper of va(x, to = "logmar")</span></span>
<span><span class="co">#&gt; From etdrs</span></span>
<span><span class="co">#&gt; [1] 1.24 0.58 0.22 0.54</span></span>
<span></span>
<span><span class="co">## ... or convert to snellen</span></span>
<span><span class="fu"><a href="reference/VAwrapper.html">to_snellen</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> </span>
<span><span class="co">#&gt; From etdrs</span></span>
<span><span class="co">#&gt; [1] "20/320" "20/80"  "20/32"  "20/70"</span></span>
<span></span>
<span><span class="co">## eye knows metric as well </span></span>
<span><span class="fu"><a href="reference/VAwrapper.html">to_snellen</a></span><span class="op">(</span><span class="va">x</span>, type <span class="op">=</span> <span class="st">"m"</span><span class="op">)</span> </span>
<span><span class="co">#&gt; From etdrs</span></span>
<span><span class="co">#&gt; [1] "6/96"  "6/24"  "6/9.6" "6/21"</span></span>
<span></span>
<span><span class="co">## And the decimal snellen notation, so much loved in Germany</span></span>
<span><span class="fu"><a href="reference/VAwrapper.html">to_snellen</a></span><span class="op">(</span><span class="va">x</span>, type <span class="op">=</span> <span class="st">"dec"</span><span class="op">)</span> </span>
<span><span class="co">#&gt; From etdrs</span></span>
<span><span class="co">#&gt; [1] "0.062" "0.25"  "0.625" "0.3"</span></span>
<span></span>
<span><span class="co">## Remove weird entries and implausible entries depending on the VA choice</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"NLP"</span>, <span class="st">"0.8"</span>, <span class="st">"34"</span>, <span class="st">"3/60"</span>, <span class="st">"2/200"</span>, <span class="st">"20/50"</span>, <span class="st">"  "</span>, <span class="st">"."</span>, <span class="st">"-"</span>, <span class="st">"NULL"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="reference/VAwrapper.html">to_snellen</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">#&gt; From snellen. Could be snellen, logmar, snellendec, etdrs</span></span>
<span><span class="co">#&gt; 6x NA introduced for: 0.8, 34,   , ., -, NULL</span></span>
<span><span class="co">#&gt;  [1] "20/20000" NA         NA         "20/400"   "20/2000"  "20/50"   </span></span>
<span><span class="co">#&gt;  [7] NA         NA         NA         NA</span></span>
<span><span class="fu"><a href="reference/VAwrapper.html">to_snellen</a></span><span class="op">(</span><span class="va">x</span>, from <span class="op">=</span> <span class="st">"snellendec"</span><span class="op">)</span></span>
<span><span class="co">#&gt; 8x NA introduced for: 34, 3/60, 2/200, 20/50,   , ., -, NULL</span></span>
<span><span class="co">#&gt;  [1] "20/20000" "20/25"    NA         NA         NA         NA        </span></span>
<span><span class="co">#&gt;  [7] NA         NA         NA         NA</span></span>
<span><span class="fu"><a href="reference/VAwrapper.html">to_snellen</a></span><span class="op">(</span><span class="va">x</span>, from <span class="op">=</span> <span class="st">"etdrs"</span><span class="op">)</span></span>
<span><span class="co">#&gt; 8x NA introduced for: 0.8, 3/60, 2/200, 20/50,   , ., -, NULL</span></span>
<span><span class="co">#&gt;  [1] "20/20000" NA         "20/200"   NA         NA         NA        </span></span>
<span><span class="co">#&gt;  [7] NA         NA         NA         NA</span></span>
<span><span class="fu"><a href="reference/VAwrapper.html">to_snellen</a></span><span class="op">(</span><span class="va">x</span>, from <span class="op">=</span> <span class="st">"logmar"</span><span class="op">)</span></span>
<span><span class="co">#&gt; 8x NA introduced for: 34, 3/60, 2/200, 20/50,   , ., -, NULL</span></span>
<span><span class="co">#&gt;  [1] "20/20000" "20/125"   NA         NA         NA         NA        </span></span>
<span><span class="co">#&gt;  [7] NA         NA         NA         NA</span></span>
<span></span>
<span><span class="co">## "plus/minus" entries are converted to the most probable threshold (any spaces allowed) </span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"20/200 - 1"</span>, <span class="st">"6/6-2"</span>, <span class="st">"20/50 + 3"</span>, <span class="st">"6/6-4"</span>, <span class="st">"20/33 + 4"</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/VAwrapper.html">to_logmar</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">#&gt; From snellen</span></span>
<span><span class="co">#&gt; [1] 1.0 0.0 0.3 0.1 0.1</span></span>
<span></span>
<span><span class="co">## or evaluating them as logmar values (each optotype equals 0.02 logmar)</span></span>
<span><span class="fu"><a href="reference/VAwrapper.html">to_logmar</a></span><span class="op">(</span><span class="va">x</span>, smallstep <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; From snellen</span></span>
<span><span class="co">#&gt; [1] 1.02 0.04 0.34 0.08 0.14</span></span>
<span></span>
<span><span class="co">## or you can also decide to completely ignore them (converting them to the nearest snellen value in the VA chart, or if you convert to logMAR, rounding to the first digit)</span></span>
<span><span class="fu"><a href="reference/VAwrapper.html">to_snellen</a></span><span class="op">(</span><span class="va">x</span>, noplus <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; From snellen</span></span>
<span><span class="co">#&gt; [1] "20/200" "20/20"  "20/50"  "20/20"  "20/32"</span></span>
<span></span>
<span><span class="co"># terribly mixed notations</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="st">"nlp"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, <span class="fl">1.1</span>, <span class="op">-</span><span class="fl">1</span>, <span class="st">"20/40"</span>, <span class="st">"4/6"</span>, <span class="st">"6/1000"</span>, <span class="fl">34</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/va_mixed.html">va_mixed</a></span><span class="op">(</span><span class="va">x</span>, to <span class="op">=</span> <span class="st">"snellen"</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] NA         "20/20000" "20/2000"  "20/2000"  "20/250"   NA        </span></span>
<span><span class="co">#&gt;  [7] "20/40"    "20/32"    "20/4000"  "20/200"</span></span>
<span></span>
<span><span class="co"># "I only have snellen and snellen decimal notation in my data"</span></span>
<span><span class="fu"><a href="reference/va_mixed.html">va_mixed</a></span><span class="op">(</span><span class="va">x</span>, to <span class="op">=</span> <span class="st">"snellen"</span>, possible <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"snellen"</span>, <span class="st">"snellendec"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] NA         "20/20000" "20/20"    "20/10"    "20/20"    NA        </span></span>
<span><span class="co">#&gt;  [7] "20/40"    "20/32"    "20/4000"  NA</span></span>
<span></span>
<span><span class="co"># "I have snellen, logmar and etdrs in my data, and there is no etdrs value less than 4"</span></span>
<span><span class="fu"><a href="reference/va_mixed.html">va_mixed</a></span><span class="op">(</span><span class="va">x</span>, to <span class="op">=</span> <span class="st">"snellen"</span>, possible <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"snellen"</span>, <span class="st">"logmar"</span>, <span class="st">"etdrs"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] NA         "20/20000" "20/200"   "20/2000"  "20/250"   NA        </span></span>
<span><span class="co">#&gt;  [7] "20/40"    "20/32"    "20/4000"  "20/200"</span></span>
<span></span>
<span><span class="co">## just clean your entries without conversion</span></span>
<span><span class="fu"><a href="reference/va.html">va</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] NA       "nlp"    "1"      "2"      "1.1"    "-1"     "20/40"  "4/6"   </span></span>
<span><span class="co">#&gt;  [9] "6/1000" "34"</span></span>
<span></span>
<span><span class="co">## recognises various ways to write qualitative values such as "hand motion"</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">23</span>, <span class="st">"20/50"</span>, <span class="st">"hand motion"</span>, <span class="st">"hm"</span>, <span class="st">"count fingers"</span>, <span class="st">"no light perception"</span>, <span class="st">"nlp"</span>, <span class="st">"nonsense"</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/va.html">va</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="co">#&gt; 1x NA introduced for: nonsense</span></span>
<span><span class="co">#&gt; [1] "23"    "20/50" "hm"    "hm"    "cf"    "nlp"   "nlp"   NA</span></span>
<span></span>
<span><span class="co">## you can set custom strings that are recognised as values</span></span>
<span><span class="fu"><a href="reference/set_eye_strings.html">set_eye_strings</a></span><span class="op">(</span>nlp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"nonsense"</span>, <span class="st">"nlp"</span>, <span class="st">"no light perception"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/va.html">va</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "23"    "20/50" "hm"    "hm"    "cf"    "nlp"   "nlp"   "nlp"</span></span>
<span></span>
<span><span class="co">## reset to default with an empty call to set_eye_strings</span></span>
<span><span class="fu"><a href="reference/set_eye_strings.html">set_eye_strings</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/va.html">va</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="co">#&gt; 1x NA introduced for: nonsense</span></span>
<span><span class="co">#&gt; [1] "23"    "20/50" "hm"    "hm"    "cf"    "nlp"   "nlp"   NA</span></span>
<span></span>
<span><span class="co">## use your own custom values for qualitative entries</span></span>
<span><span class="fu"><a href="reference/VAwrapper.html">to_logmar</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="co">#&gt; From snellen. Could be snellen, logmar, snellendec, etdrs</span></span>
<span><span class="co">#&gt; 2x NA introduced for: 23, nonsense</span></span>
<span><span class="co">#&gt; [1]  NA 0.4 2.3 2.3 2.0 3.0 3.0  NA</span></span>
<span><span class="fu"><a href="reference/VAwrapper.html">to_logmar</a></span><span class="op">(</span><span class="va">y</span>, quali_values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>cf <span class="op">=</span> <span class="fl">2</span>, hm <span class="op">=</span> <span class="fl">3</span>, lp <span class="op">=</span> <span class="fl">4</span>, nlp <span class="op">=</span> <span class="fl">6</span> <span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; From snellen. Could be snellen, logmar, snellendec, etdrs</span></span>
<span><span class="co">#&gt; 2x NA introduced for: 23, nonsense</span></span>
<span><span class="co">#&gt; [1]  NA 0.4 3.0 3.0 2.0 6.0 6.0  NA</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="count-subjects-and-eyes">Count subjects and eyes<a class="anchor" aria-label="anchor" href="#count-subjects-and-eyes"></a>
</h3>
<p>This is a massive convenience function to count subjects and eyes. Because this essentially returns a list, the stored data can easily be accessed by subsetting (e.g., with <code>$</code>). You can get the subject IDs for each subset with <code>details = TRUE</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tjebo/eyedata">eyedata</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/eyes.html">eyes</a></span><span class="op">(</span><span class="va">amd2</span><span class="op">)</span></span>
<span><span class="co">#&gt; ══ Counts ═══════════════</span></span>
<span><span class="co">#&gt;    id  eyes right  left </span></span>
<span><span class="co">#&gt;  3357  3357  1681  1676</span></span>
<span></span>
<span><span class="fu"><a href="reference/eyes.html">eyes</a></span><span class="op">(</span><span class="va">amd2</span><span class="op">)</span><span class="op">$</span><span class="va">right</span></span>
<span><span class="co">#&gt; [1] 1681</span></span>
<span></span>
<span><span class="fu"><a href="reference/eyes.html">eyes</a></span><span class="op">(</span><span class="va">amd2</span>, details <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; ══ $counts ══════════════════════════════════</span></span>
<span><span class="co">#&gt;    id  eyes right  left  both </span></span>
<span><span class="co">#&gt;  3357  3357  1681  1676     0 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ══ $id ══════════════════════════════════════</span></span>
<span><span class="co">#&gt; $right</span></span>
<span><span class="co">#&gt; [1] "id_100"  "id_1001" "id_1002" "id_1003" "id_1007" "id_1009"</span></span>
<span><span class="co">#&gt; # … with 1675 more subjects</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $left</span></span>
<span><span class="co">#&gt; [1] "id_1"    "id_10"   "id_1000" "id_1004" "id_1005" "id_1006"</span></span>
<span><span class="co">#&gt; # … with 1670 more subjects</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $both</span></span>
<span><span class="co">#&gt; character(0)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="reference/eyes.html">eyes</a></span><span class="op">(</span><span class="va">amd2</span>, details <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">$</span><span class="va">id</span><span class="op">$</span><span class="va">right</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "id_100"  "id_1001" "id_1002" "id_1003" "id_1007" "id_1009"</span></span></code></pre></div>
<div class="section level4">
<h4 id="smooth-integration-into-rmarkdown">Smooth integration into rmarkdown<a class="anchor" aria-label="anchor" href="#smooth-integration-into-rmarkdown"></a>
</h4>
<p><code>eyestr</code> was designed with the use in rmarkdown in mind, most explicitly for the use inline. You can change the way numbers are converted to english with the <code>english</code> argument. By default, numbers smaller than or equal to 12 will be real English, all other numbers will be … numbers. You can capitalise the first number with the <code>caps</code> argument.</p>
<table class="table">
<colgroup>
<col width="50%">
<col width="50%">
</colgroup>
<thead><tr class="header">
<th>rmarkdown code</th>
<th>results in</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>We analyzed <code>`r eyestr(amd2)`</code>
</td>
<td>We analyzed 3357 eyes of 3357 patients</td>
</tr>
<tr class="even">
<td>We analyzed <code>`r eyestr(head(amd2, 100))`</code>
</td>
<td>We analyzed eleven eyes of eleven patients</td>
</tr>
<tr class="odd">
<td>We analyzed <code>`r eyestr(amd2, english = "all")`</code>
</td>
<td>We analyzed three thousand three hundred fifty-seven eyes of three thousand three hundred fifty-seven patients</td>
</tr>
<tr class="even">
<td>
<code>`r eyestr(head(amd2, 100), caps = TRUE)`</code> were analyzed</td>
<td>Eleven eyes of eleven patients were analyzed</td>
</tr>
<tr class="odd">
<td>We analyzed <code>`r eyestr(head(amd2, 100), english = "none")`</code>
</td>
<td>We analyzed 11 eyes of 11 patients</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level3">
<h3 id="recoding-the-eye-variable">Recoding the eye variable<a class="anchor" aria-label="anchor" href="#recoding-the-eye-variable"></a>
</h3>
<p>Makes recoding eye variables very easy. It deals with weird missing entries like <code>"."</code> and <code>""</code>, or <code>"N/A"</code></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"r"</span>, <span class="st">"re"</span>, <span class="st">"od"</span>, <span class="st">"right"</span>, <span class="st">"l"</span>, <span class="st">"le"</span>, <span class="st">"os"</span>, <span class="st">"left"</span>, <span class="st">"both"</span>, <span class="st">"ou"</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/recodeye.html">recodeye</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "r" "r" "r" "r" "l" "l" "l" "l" "b" "b"</span></span>
<span></span>
<span><span class="co">## chose the resulting codes</span></span>
<span><span class="fu"><a href="reference/recodeye.html">recodeye</a></span><span class="op">(</span><span class="va">x</span>, to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"od"</span>, <span class="st">"os"</span>, <span class="st">"ou"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "od" "od" "od" "od" "os" "os" "os" "os" "ou" "ou"</span></span>
<span></span>
<span><span class="co">## Numeric codes 0:1/ 1:2 are recognized </span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span></span>
<span><span class="fu"><a href="reference/recodeye.html">recodeye</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">#&gt; Eyes coded 1:2. Interpreting r = 1</span></span>
<span><span class="co">#&gt; [1] "r" "l"</span></span>
<span></span>
<span><span class="co">## with weird missing values</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, <span class="st">"."</span>, <span class="cn">NA</span>, <span class="st">""</span>, <span class="st">"    "</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/recodeye.html">recodeye</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">#&gt; Missing values and/or meaningless strings contained</span></span>
<span><span class="co">#&gt; Eyes coded 1:2. Interpreting r = 1</span></span>
<span><span class="co">#&gt; [1] "r" "l" NA  NA  NA  NA</span></span>
<span></span>
<span><span class="co">## If you are using different strings to code for eyes, e.g., you are using a different language, you can change this either with the "eyestrings" argument</span></span>
<span><span class="va">french</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"OD"</span>, <span class="st">"droit"</span>, <span class="st">"gauche"</span>, <span class="st">"OG"</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/recodeye.html">recodeye</a></span><span class="op">(</span><span class="va">french</span>, eyestrings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>r <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"droit"</span>, <span class="st">"od"</span><span class="op">)</span>, l <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"gauche"</span>, <span class="st">"og"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "r" "r" "l" "l"</span></span>
<span></span>
<span><span class="co">## or change it more globally with `set_eye_strings`</span></span>
<span><span class="fu"><a href="reference/set_eye_strings.html">set_eye_strings</a></span><span class="op">(</span>right <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"droit"</span>, <span class="st">"od"</span><span class="op">)</span>, left <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"gauche"</span>, <span class="st">"og"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/recodeye.html">recodeye</a></span><span class="op">(</span><span class="va">french</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "r" "r" "l" "l"</span></span>
<span></span>
<span><span class="co"># to restore the default, call set_eye_strings empty</span></span>
<span><span class="fu"><a href="reference/set_eye_strings.html">set_eye_strings</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="clean-na-entries">Clean NA entries<a class="anchor" aria-label="anchor" href="#clean-na-entries"></a>
</h3>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"   "</span>, <span class="st">"."</span>, <span class="st">"-"</span>, <span class="st">"NULL"</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/tidyNA.html">tidyNA</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "a" NA  NA  NA  NA</span></span>
<span></span>
<span><span class="co"># in addition to the default strings, a new string can be added</span></span>
<span><span class="fu"><a href="reference/tidyNA.html">tidyNA</a></span><span class="op">(</span><span class="va">x</span>, string <span class="op">=</span> <span class="st">"a"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] NA NA NA NA NA</span></span>
<span></span>
<span><span class="co"># or just remove the strings you want</span></span>
<span><span class="fu"><a href="reference/tidyNA.html">tidyNA</a></span><span class="op">(</span><span class="va">x</span>, string <span class="op">=</span> <span class="st">"a"</span>, defaultstrings <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] NA     "   "  "."    "-"    "NULL"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="reveal">reveal<a class="anchor" aria-label="anchor" href="#reveal"></a>
</h3>
<p>Show common statistics for all numeric columns, for the entire cohort or aggregated by group(s):</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/reveal.html">reveal</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span></span>
<span><span class="co">#&gt;            var mean  sd   n min max</span></span>
<span><span class="co">#&gt; 1 Sepal.Length  5.8 0.8 150 4.3 7.9</span></span>
<span><span class="co">#&gt; 2  Sepal.Width  3.1 0.4 150 2.0 4.4</span></span>
<span><span class="co">#&gt; 3 Petal.Length  3.8 1.8 150 1.0 6.9</span></span>
<span><span class="co">#&gt; 4  Petal.Width  1.2 0.8 150 0.1 2.5</span></span>
<span><span class="co">#&gt; 5      Species  2.0 0.8 150 1.0 3.0</span></span>
<span></span>
<span><span class="fu"><a href="reference/reveal.html">reveal</a></span><span class="op">(</span><span class="va">iris</span>, by <span class="op">=</span> <span class="st">"Species"</span><span class="op">)</span> <span class="co">#can be several groups</span></span>
<span><span class="co">#&gt;      var1   var2   var3   var4       var5       var6       var7       var8</span></span>
<span><span class="co">#&gt; 1  setosa setosa setosa setosa versicolor versicolor versicolor versicolor</span></span>
<span><span class="co">#&gt; 2  setosa setosa setosa setosa versicolor versicolor versicolor versicolor</span></span>
<span><span class="co">#&gt; 3  setosa setosa setosa setosa versicolor versicolor versicolor versicolor</span></span>
<span><span class="co">#&gt; 4  setosa setosa setosa setosa versicolor versicolor versicolor versicolor</span></span>
<span><span class="co">#&gt; 5  setosa setosa setosa setosa versicolor versicolor versicolor versicolor</span></span>
<span><span class="co">#&gt; 6  setosa setosa setosa setosa versicolor versicolor versicolor versicolor</span></span>
<span><span class="co">#&gt; 7  setosa setosa setosa setosa versicolor versicolor versicolor versicolor</span></span>
<span><span class="co">#&gt; 8  setosa setosa setosa setosa versicolor versicolor versicolor versicolor</span></span>
<span><span class="co">#&gt; 9  setosa setosa setosa setosa versicolor versicolor versicolor versicolor</span></span>
<span><span class="co">#&gt; 10 setosa setosa setosa setosa versicolor versicolor versicolor versicolor</span></span>
<span><span class="co">#&gt; 11 setosa setosa setosa setosa versicolor versicolor versicolor versicolor</span></span>
<span><span class="co">#&gt; 12 setosa setosa setosa setosa versicolor versicolor versicolor versicolor</span></span>
<span><span class="co">#&gt;         var9     var10     var11     var12          var mean  sd  n min max</span></span>
<span><span class="co">#&gt; 1  virginica virginica virginica virginica Sepal.Length  5.0 0.4 50 4.3 5.8</span></span>
<span><span class="co">#&gt; 2  virginica virginica virginica virginica  Sepal.Width  3.4 0.4 50 2.3 4.4</span></span>
<span><span class="co">#&gt; 3  virginica virginica virginica virginica Petal.Length  1.5 0.2 50 1.0 1.9</span></span>
<span><span class="co">#&gt; 4  virginica virginica virginica virginica  Petal.Width  0.2 0.1 50 0.1 0.6</span></span>
<span><span class="co">#&gt; 5  virginica virginica virginica virginica Sepal.Length  5.9 0.5 50 4.9 7.0</span></span>
<span><span class="co">#&gt; 6  virginica virginica virginica virginica  Sepal.Width  2.8 0.3 50 2.0 3.4</span></span>
<span><span class="co">#&gt; 7  virginica virginica virginica virginica Petal.Length  4.3 0.5 50 3.0 5.1</span></span>
<span><span class="co">#&gt; 8  virginica virginica virginica virginica  Petal.Width  1.3 0.2 50 1.0 1.8</span></span>
<span><span class="co">#&gt; 9  virginica virginica virginica virginica Sepal.Length  6.6 0.6 50 4.9 7.9</span></span>
<span><span class="co">#&gt; 10 virginica virginica virginica virginica  Sepal.Width  3.0 0.3 50 2.2 3.8</span></span>
<span><span class="co">#&gt; 11 virginica virginica virginica virginica Petal.Length  5.6 0.6 50 4.5 6.9</span></span>
<span><span class="co">#&gt; 12 virginica virginica virginica virginica  Petal.Width  2.0 0.3 50 1.4 2.5</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="getage">getage<a class="anchor" aria-label="anchor" href="#getage"></a>
</h3>
<ul>
<li>Calculate age in years, as <a href="https://lubridate.tidyverse.org/articles/lubridate.html#time-intervals" class="external-link">periods or durations</a>
</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dob</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1984-10-16"</span>, <span class="st">"2000-01-01"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## If no second date given, the age today</span></span>
<span><span class="fu"><a href="reference/getage.html">getage</a></span><span class="op">(</span><span class="va">dob</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 40.9 25.7</span></span>
<span><span class="fu"><a href="reference/getage.html">getage</a></span><span class="op">(</span><span class="va">dob</span>, <span class="st">"2000-01-01"</span><span class="op">)</span>                                                    </span>
<span><span class="co">#&gt; [1] 15.2  0.0</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="myop">myop<a class="anchor" aria-label="anchor" href="#myop"></a>
</h3>
<p>Often enough, there are right eye / left eye columns for more than one variable, e.g., for both IOP and VA. This may be a necessary data formal for specific questions. However, “eye” is also variable (a dimension of your observation), and it can also be stored in a separate column. The data would be “longer”.</p>
<p>Indeed, R requires exactly this data shape for many tasks: “eye[r/l]” as a separate column, and each eye-related variable (e.g., IOP or VA) in their own dedicated column.</p>
<p><code>myop</code> provides an easy to use API for an automatic reshape of your data to a “myop” format.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Simple data frame with one column for right eye and left eye.</span></span>
<span><span class="va">iop_wide</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>id <span class="op">=</span> <span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>, iop_r <span class="op">=</span> <span class="fl">11</span><span class="op">:</span><span class="fl">13</span>, iop_l <span class="op">=</span> <span class="fl">14</span><span class="op">:</span><span class="fl">16</span><span class="op">)</span></span>
<span><span class="va">iop_wide</span></span>
<span><span class="co">#&gt;   id iop_r iop_l</span></span>
<span><span class="co">#&gt; 1  a    11    14</span></span>
<span><span class="co">#&gt; 2  b    12    15</span></span>
<span><span class="co">#&gt; 3  c    13    16</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/myop.html">myop</a></span><span class="op">(</span><span class="va">iop_wide</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 3</span></span>
<span><span class="co">#&gt;   id    eye   iop  </span></span>
<span><span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;</span></span>
<span><span class="co">#&gt; 1 a     right 11   </span></span>
<span><span class="co">#&gt; 2 a     left  14   </span></span>
<span><span class="co">#&gt; 3 b     right 12   </span></span>
<span><span class="co">#&gt; 4 b     left  15   </span></span>
<span><span class="co">#&gt; 5 c     right 13   </span></span>
<span><span class="co">#&gt; 6 c     left  16</span></span></code></pre></div>
Or another example with many more variables:
<details><summary>
Click to unfold code to create <code>wide_df</code>
</summary><div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wide_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  id <span class="op">=</span> <span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span>, </span>
<span>  surgery_right <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TE"</span>, <span class="st">"TE"</span>, <span class="st">"SLT"</span>, <span class="st">"SLT"</span><span class="op">)</span>,</span>
<span>  surgery_left <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TE"</span>, <span class="st">"TE"</span>, <span class="st">"TE"</span>, <span class="st">"SLT"</span><span class="op">)</span>,</span>
<span>  iop_r_preop <span class="op">=</span> <span class="fl">21</span><span class="op">:</span><span class="fl">24</span>, iop_r_postop <span class="op">=</span> <span class="fl">11</span><span class="op">:</span><span class="fl">14</span>,</span>
<span>  iop_l_preop <span class="op">=</span> <span class="fl">31</span><span class="op">:</span><span class="fl">34</span>, iop_l_postop <span class="op">=</span> <span class="fl">11</span><span class="op">:</span><span class="fl">14</span>, </span>
<span>  va_r_preop <span class="op">=</span> <span class="fl">41</span><span class="op">:</span><span class="fl">44</span>, va_r_postop <span class="op">=</span> <span class="fl">45</span><span class="op">:</span><span class="fl">48</span>,</span>
<span>  va_l_preop <span class="op">=</span> <span class="fl">41</span><span class="op">:</span><span class="fl">44</span>, va_l_postop <span class="op">=</span> <span class="fl">45</span><span class="op">:</span><span class="fl">48</span></span>
<span><span class="op">)</span></span></code></pre></div>
</details><p><img src="reference/figures/messy.png"></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myop_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/myop.html">myop</a></span><span class="op">(</span><span class="va">wide_df</span><span class="op">)</span></span>
<span></span>
<span><span class="va">myop_df</span></span>
<span><span class="co">#&gt; # A tibble: 8 × 7</span></span>
<span><span class="co">#&gt;   id    eye   surgery iop_preop iop_postop va_preop va_postop</span></span>
<span><span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;     &lt;chr&gt;      &lt;chr&gt;    &lt;chr&gt;    </span></span>
<span><span class="co">#&gt; 1 a     right TE      21        11         41       45       </span></span>
<span><span class="co">#&gt; 2 a     left  TE      31        11         41       45       </span></span>
<span><span class="co">#&gt; 3 b     right TE      22        12         42       46       </span></span>
<span><span class="co">#&gt; 4 b     left  TE      32        12         42       46       </span></span>
<span><span class="co">#&gt; 5 c     right SLT     23        13         43       47       </span></span>
<span><span class="co">#&gt; 6 c     left  TE      33        13         43       47       </span></span>
<span><span class="co">#&gt; 7 d     right SLT     24        14         44       48       </span></span>
<span><span class="co">#&gt; 8 d     left  SLT     34        14         44       48</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="hyperop">hyperop<a class="anchor" aria-label="anchor" href="#hyperop"></a>
</h3>
<p>If you actually need certain eye-related variables spread over two columns, <code><a href="reference/hyperop.html">hyperop()</a></code> is your friend:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/hyperop.html">hyperop</a></span><span class="op">(</span><span class="fu"><a href="reference/myop.html">myop</a></span><span class="op">(</span><span class="va">iop_wide</span><span class="op">)</span>, <span class="va">iop</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 3 × 3</span></span>
<span><span class="co">#&gt;   id    r_iop l_iop</span></span>
<span><span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;</span></span>
<span><span class="co">#&gt; 1 a     11    14   </span></span>
<span><span class="co">#&gt; 2 b     12    15   </span></span>
<span><span class="co">#&gt; 3 c     13    16</span></span>
<span></span>
<span><span class="fu"><a href="reference/hyperop.html">hyperop</a></span><span class="op">(</span><span class="va">myop_df</span>, cols <span class="op">=</span> <span class="fu">matches</span><span class="op">(</span><span class="st">"va|iop"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 5 × 10</span></span>
<span><span class="co">#&gt;   id    surgery r_iop_preop r_iop_postop r_va_preop r_va_postop l_iop_preop</span></span>
<span><span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;       &lt;chr&gt;        &lt;chr&gt;      &lt;chr&gt;       &lt;chr&gt;      </span></span>
<span><span class="co">#&gt; 1 a     TE      21          11           41         45          31         </span></span>
<span><span class="co">#&gt; 2 b     TE      22          12           42         46          32         </span></span>
<span><span class="co">#&gt; 3 c     SLT     23          13           43         47          &lt;NA&gt;       </span></span>
<span><span class="co">#&gt; 4 c     TE      &lt;NA&gt;        &lt;NA&gt;         &lt;NA&gt;       &lt;NA&gt;        33         </span></span>
<span><span class="co">#&gt; 5 d     SLT     24          14           44         48          34         </span></span>
<span><span class="co">#&gt; # ℹ 3 more variables: l_iop_postop &lt;chr&gt;, l_va_preop &lt;chr&gt;, l_va_postop &lt;chr&gt;</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="blink">blink<a class="anchor" aria-label="anchor" href="#blink"></a>
</h3>
<p>See your data in a blink of an eye - wrapper around <a href="#myop"><code>myop</code></a>, <a href="#eyes"><code>eyes</code></a>, <a href="#va"><code>va</code></a> and <a href="#reveal"><code>reveal</code></a>. It will look for VA and for IOP columns and provide the summary stats for the entire cohort and for right and left eyes for each variable.</p>
<p><a href="#names-and-codes"><strong>This requires a certain format of your names and codes</strong></a></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/blink.html">blink</a></span><span class="op">(</span><span class="va">wide_df</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="names-and-codes">Names and codes<a class="anchor" aria-label="anchor" href="#names-and-codes"></a>
</h2>
<p><strong>eye works smoother with tidy data</strong> (any package does, really!)</p>
<p>An important part of tidy data are good names. <a href="https://tidyr.tidyverse.org/articles/tidy-data.html" class="external-link">Learn more about tidy data.</a></p>
<div class="section level3">
<h3 id="tips-and-rules-for-naming">Tips and rules for naming:<a class="anchor" aria-label="anchor" href="#tips-and-rules-for-naming"></a>
</h3>
<ol style="list-style-type: decimal">
<li>Don’t be too creative with your names!</li>
<li>Use common coding:</li>
</ol>
<ul>
<li>
<strong>eyes</strong>: “r”, “re”, “od”, “right” - or numeric coding r:l = 0:1 or 1:2</li>
<li>
<strong>Visual acuity</strong>: “VA”, “BCVA”, “Acuity”</li>
<li>
<strong>Intraocular pressure</strong>: “IOP”, “GAT”, “NCT”, “pressure”</li>
<li>
<strong>Patient identifier</strong>: “pat”, “patient”, “ID” (ideally both: “patientID” or “patID”)</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li>Column names:</li>
</ol>
<ul>
<li>No spaces!</li>
<li>Do not use numeric coding for eyes in column names</li>
<li>Separate eye and VA and IOP codes with underscores (“bcva_l_preop”, “VA_r”, “left_va”, “IOP_re”)</li>
<li>Keep names short</li>
<li>Don’t use underscores when you don’t need to: Consider each section divided by an underscore as a relevant characteristic of your variable. E.g., “preop” instead of “pre_op”, or simply “VA” instead of “VA_ETDRS_Letters”</li>
</ul>
</div>
<div class="section level3">
<h3 id="name-examples">Name examples<a class="anchor" aria-label="anchor" href="#name-examples"></a>
</h3>
<p>Good names (<code>eye</code> will work nicely)</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## right and left eyes have common codes</span></span>
<span><span class="co">## information on the tested dimension is included ("iop")</span></span>
<span><span class="co">## VA and eye strings are separated by underscores</span></span>
<span><span class="co">## No unnecessary underscores.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">wide_df</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "id"            "surgery_right" "surgery_left"  "iop_r_preop"  </span></span>
<span><span class="co">#&gt;  [5] "iop_r_postop"  "iop_l_preop"   "iop_l_postop"  "va_r_preop"   </span></span>
<span><span class="co">#&gt;  [9] "va_r_postop"   "va_l_preop"    "va_l_postop"</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">iop_wide</span><span class="op">)</span> </span>
<span><span class="co">#&gt; [1] "id"    "iop_r" "iop_l"</span></span></code></pre></div>
<p>OK names (<code>eye</code> will work)</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Id and Eye are common names, there are no spaces</span></span>
<span><span class="co">## VA is separated from the rest with an underscore</span></span>
<span><span class="co">## BUT: </span></span>
<span><span class="co">## The names are quite long </span></span>
<span><span class="co">## There is an unnecessary underscore (etdrs are always letters). Better just "VA"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Id"</span>, <span class="st">"Eye"</span>, <span class="st">"FollowupDays"</span>, <span class="st">"BaselineAge"</span>, <span class="st">"Gender"</span>, <span class="st">"VA_ETDRS_Letters"</span>, </span>
<span><span class="st">"InjectionNumber"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Id"               "Eye"              "FollowupDays"     "BaselineAge"     </span></span>
<span><span class="co">#&gt; [5] "Gender"           "VA_ETDRS_Letters" "InjectionNumber"</span></span>
<span></span>
<span><span class="co">## All names are commonly used (good!)</span></span>
<span><span class="co">## But which dimension of "r"/"l" are we exactly looking at? </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"r"</span>,  <span class="st">"l"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "id" "r"  "l"</span></span></code></pre></div>
<p>Bad names (<code>eye</code> will fail)</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## VA/IOP not separated with underscore</span></span>
<span><span class="co">## `eye` won't be able to recognize IOP and VA columns</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"iopr"</span>, <span class="st">"iopl"</span>, <span class="st">"VAr"</span>, <span class="st">"VAl"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "id"   "iopr" "iopl" "VAr"  "VAl"</span></span>
<span></span>
<span><span class="co">## A human may think this is clear</span></span>
<span><span class="co">## But `eye` will fail to understand those variable names</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"person"</span>, <span class="st">"goldmann"</span>, <span class="st">"vision"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "person"   "goldmann" "vision"</span></span>
<span></span>
<span><span class="co">## Not even clear to humans</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"var1"</span>, <span class="st">"var2"</span>, <span class="st">"var3"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "var1" "var2" "var3"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="how-do-i-rename-columns-in-r">How do I rename columns in R?<a class="anchor" aria-label="anchor" href="#how-do-i-rename-columns-in-r"></a>
</h3>
<p>When I started with R, I found it challenging to rename columns and I found the following threads on stackoverflow very helpful:</p>
<ul>
<li><a href="https://stackoverflow.com/q/7531868/7941188" class="external-link">Rename single column</a></li>
<li><a href="https://stackoverflow.com/q/20987295/7941188" class="external-link">Rename columns with named vector</a></li>
</ul>
<p>I find the two following methods straight forward:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># I've got a data frame with unfortunate names:</span></span>
<span><span class="va">name_mess</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"a"</span>, oculus <span class="op">=</span> <span class="st">"r"</span>, eyepressure <span class="op">=</span> <span class="fl">14</span>, vision <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">name_mess</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "name"        "oculus"      "eyepressure" "vision"</span></span>
<span></span>
<span><span class="co">## rename all names</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">name_mess</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"patID"</span>, <span class="st">"eye"</span>, <span class="st">"IOP"</span>, <span class="st">"VA"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">name_mess</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "patID" "eye"   "IOP"   "VA"</span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## To rename only specific columns, even if you are not sure about their exact position:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">name_mess</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">name_mess</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"name"</span>, <span class="st">"vision"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"patID"</span>, <span class="st">"VA"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">name_mess</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "patID"       "oculus"      "eyepressure" "VA"</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="important-notes">Important notes<a class="anchor" aria-label="anchor" href="#important-notes"></a>
</h2>
<p><strong>I do not assume responsability for your data or analysis</strong>. Please always keep a critical mind when working with data - if you do get results that seem implausible, there may be a chance that the data is in an unfortunate shape for which <code>eye</code> may not be suitable.</p>
</div>
<div class="section level2">
<h2 id="va-conversion">VA conversion<a class="anchor" aria-label="anchor" href="#va-conversion"></a>
</h2>
<ul>
<li>VA conversion between Snellen, ETDRS and logMAR is based on charts and formulas in (<a href="#ref-holladay">Holladay 2004</a>), (<a href="#ref-beck">Beck et al. 2003</a>) and (<a href="#ref-gregori">Gregori, Feuer, and Rosenfeld 2010</a>)</li>
<li>Categories <strong>counting fingers</strong> and <strong>hand movements</strong> are converted following (<a href="#ref-bach">Schulze-Bonsel et al. 2006</a>)</li>
<li>Categories <strong>(no) light perception</strong> are converted following the suggestions by Michael Bach</li>
</ul>
</div>
<div class="section level2">
<h2 id="acknowledgements">Acknowledgements<a class="anchor" aria-label="anchor" href="#acknowledgements"></a>
</h2>
<ul>
<li>Thanks to <strong>Alasdair Warwick</strong>, <strong>Aaron Lee</strong>, <strong>Tim Yap</strong>, <strong>Siegfried Wagner</strong> and <strong>Abraham Olvera</strong> for great suggestions, testing and code review.<br>
</li>
<li>
<strong>Pearse Keane</strong>, <strong>Dun Jack Fu</strong>, <strong>Katrin Fasler</strong> and <strong>Christoph Kern</strong> for their contribution of open source data</li>
<li>Thanks to <a href="https://github.com/moodymudskipper" class="external-link">Antoine Fabri</a> for his contribution to <code><a href="reference/getage.html">getage()</a></code>
</li>
<li>Thanks to Hadley Wickham and all developers of the <code>tidyverse</code> packages and the packages <code>roxygen2</code>, <code>usethis</code>, <code>testthis</code> and <code>devtools</code>, all on which <code>eye</code> heavily relies.</li>
</ul>
</div>
<div class="section level2">
<h2 id="resources">Resources<a class="anchor" aria-label="anchor" href="#resources"></a>
</h2>
<ul>
<li><a href="https://michaelbach.de/sci/acuity.html" class="external-link">Michael Bach’s homepage</a></li>
<li><a href="https://michaelbach.de/sci/pubs/Bach2007IOVS_eLetter_FrACT.pdf" class="external-link">Michael Bach on NLP and LP</a></li>
</ul>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-beck" class="csl-entry">
Beck, Roy W, Pamela S Moke, Andrew H Turpin, Frederick L Ferris, John Paul SanGiovanni, Chris A Johnson, Eileen E Birch, et al. 2003. “A Computerized Method of Visual Acuity Testing.” <em>American Journal of Ophthalmology</em> 135 (2): 194–205. <a href="https://doi.org/10.1016/s0002-9394(02)01825-1" class="external-link uri">https://doi.org/10.1016/s0002-9394(02)01825-1</a>.
</div>
<div id="ref-gregori" class="csl-entry">
Gregori, Ninel Z, William Feuer, and Philip J Rosenfeld. 2010. “Novel Method for Analyzing Snellen Visual Acuity Measurements.” <em>Retina</em> 30 (7): 1046–50. <a href="https://doi.org/10.1097/iae.0b013e3181d87e04" class="external-link uri">https://doi.org/10.1097/iae.0b013e3181d87e04</a>.
</div>
<div id="ref-holladay" class="csl-entry">
Holladay, Jack T. 2004. “Visual Acuity Measurements.” <em>Journal of Cataract and Refractive Surgery</em> 30 (February): 287–90. <a href="https://doi.org/10.1016/j.jcrs.2004.01.014" class="external-link uri">https://doi.org/10.1016/j.jcrs.2004.01.014</a>.
</div>
<div id="ref-bach" class="csl-entry">
Schulze-Bonsel, Kilian, Nicolas Feltgen, Hermann Burau, Lutz Hansen, and Michael Bach. 2006. “<span class="nocase">Visual Acuities ‘Hand Motion’ and ‘Counting Fingers’ Can Be Quantified with the Freiburg Visual Acuity Test</span>.” <em>Investigative Ophthalmology &amp; Visual Science</em> 47 (3): 1236–40. <a href="https://doi.org/10.1167/iovs.05-0981" class="external-link uri">https://doi.org/10.1167/iovs.05-0981</a>.
</div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=eye" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/tjebo/eye/">Browse source code</a></li>
<li><a href="https://github.com/tjebo/eye/issues">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing eye</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Tjebo Heeren <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0001-5297-2301" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a>  </li>
<li><a href="authors.html">More about authors...</a></li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/tjebo/eye/actions/workflows/R-CMD-check.yaml"><img src="https://github.com/tjebo/eye/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Tjebo Heeren.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
