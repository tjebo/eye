% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/va.R
\name{va}
\alias{va}
\title{Visual acuity notation conversion}
\usage{
va(x, from = NULL, to = NULL, type = "ft", smallstep = FALSE, noplus = FALSE)
}
\arguments{
\item{x}{Vector with visual acuity entries. Must be atomic.
Snellen fractions need to be entered with "/"}

\item{from}{will force to evaluate from which notation to convert - Must be
"etdrs", "logmar", "snellen" or "snellendec".
Ignored if the value should not be plausible.}

\item{to}{To which class to convert. "etdrs", "logmar" or "snellen" -
any case allowed. If NULL (default), will simply "clean up" VA entries.
This may then result in a vector of "mixed" VA notations.}

\item{type}{To which Snellen notation to convert: "m", "dec" or "ft"}

\item{smallstep}{how +/- entries are evaluated. FALSE:
increase/decrease Snellen fractions by lines. TRUE: plus/minus
entries equivalent to 0.02 logmar}

\item{noplus}{ignoring plus/minus entries and just returning the
snellen fraction. This overrides the smallstep argument.}
}
\value{
vector of \code{va} class. See also "VA classes"
}
\description{
Cleans and converts visual acuity notations (classes)
between Snellen (decimal, meter and feet), ETDRS, and logMAR.
}
\section{VA conversion}{

\itemize{
\item \strong{logMAR to ETDRS}: logMAR rounded to the first digit and converted with
the visual acuity chart (see section VA chart)
\item \strong{Snellen to logMAR}: logMAR = -1 * log10(snellen_frac)
\item \strong{Snellen to ETDRS}: ETDRS = 85 + 50 * log10(snellen_frac)
\href{https://doi.org/10.1097/iae.0b013e3181d87e04}{Gregori et al.}
\item \strong{ETDRS to logMAR}: logMAR = -0.02 * etdrs + 1.7
[Beck et al.)](https://doi.org/10.1016/s0002-9394(02\%2901825-1)
\item \strong{Hand movements and counting fingers} are converted following
\href{https://doi.org/10.1167/iovs.05-0981}{Schulze-Bonsel et al.}
\item \strong{(No) light perception} are converted following the suggestions by
\href{https://michaelbach.de/sci/acuity.html}{Michael Bach}
}

[Beck et al.)]: R:Beck\%20et\%20al.)
[Schulze-Bonsel et al.]: R:Schulze-Bonsel\%20et\%20al.
[Michael Bach]: R:Michael\%20Bach
}

\section{Qualitative visual acuity entries}{

In order to calculate with qualitative entries counting fingers,
hand movement and (no) perception of light, \strong{use logMAR} !
Qualitative visual acuity lower than counting fingers is assigned 0
ETDRS letter, in order to keep it as a measurement (not: NA). It is very
difficult to justify a "negative" letter score in a test which only has
a specific range (0-100).
By default, \code{va} recognises the following values (case does not matter!)
\itemize{
\item No light perception := c("nlp", "no light perception", "no light", "no perception of light", "npl"),
\item Light perception: = c("lp", "light perception", "perception of light", "pl"),
\item Hand movements: = c("hm",  "handmotion", "hand movement", "hand movements"),
\item Counting fingers: = c("cf", "counting finger", "counting fingers", "finger count", "count fingers")
}
}

\section{Converting to Snellen}{

Although there seems to be no good statistical reason to convert
back to Snellen, it is a very natural thing to eye specialists to think
in Snellen. A conversion to snellen gives a good gauge of how the visual
acuity for the patients are. However, back-conversion should not be
considered an exact science and any attempt to use formulas will result
in very weird Snellen values that have no correspondence to common charts.
Therefore, Snellen matching the nearest ETDRS and logMAR value in
the VA chart are used.
}

\section{VA chart}{

You can find the chart with \code{eye:::va_chart}.
This chart and VA conversion formulas are based on charts in
\href{https://doi.org/10.1016/j.jcrs.2004.01.014}{Holladay et al.},
[Beck et al.)](https://doi.org/10.1016/s0002-9394(02\%2901825-1), and
\href{https://doi.org/10.1097/iae.0b013e3181d87e04}{Gregori et al.}.
The ETDRS values for NLP and PL are deliberately set at those values because
they are unlikely to happen by chance as a wrong entry (and as integers),
and it has internal reasons that make conversion easier.

[Beck et al.)]: R:Beck\%20et\%20al.)
[Gregori et al.]: R:Gregori\%20et\%20al.
}

\section{Accepted VA formats / Plausibility checks}{

\itemize{
\item Snellen fractions (meter/ feet) need to be entered as fraction with
"/". Any fractions allowed. You can get creative with your snellens.
see \strong{"Examples"}
\item ETDRS must be integer-equivalent between 0 and 100 (integer equivalent
means, it can also be a character vector)
\item logMAR must be -0.3 <= x <= 3.0
\item Snellen decimal must be 0 < x <= 2
\item Qualitative must be either of PL, LP, NLP, NPL, HM, CF (any case allowed)
\item Plausibility checks are performed for the automatically or manually defined
notation.
\item Any element which is implausible/ not recognized will be converted to NA
}
}

\section{Entries with mixed VA notations}{

Use \link{va_mixed} instead.
}

\section{Snellen "+/-" entries}{

By default, plus/minus entries are evaluated as intended by the
test design: Snellen fractions increase/decrease only by lines.

\if{html}{\out{<div class="sourceCode">}}\preformatted{- if entry -2 to +2 : take same Snellen value
- if < -2 : take Snellen value one line below
- if > +2 : take Snellen value one line above
}\if{html}{\out{</div>}}

If smallstep = TRUE, each snellen optotype will be considered
equivalent to 0.02 logmar (assuming 5 letters in a row in a chart)
}

\section{VA cleaning}{

For more details see \code{\link[=clean_va]{clean_va()}}
\enumerate{
\item \code{NA} is assigned to strings such as "." or "", "n/a" or "   "
\item notation for qualitative entries is simplified.
}
}

\section{VA classes}{

Under the hood, \code{convertVA} returns a vector that has three classes:
\enumerate{
\item \code{va}
\item One of snellen, snellendec, logmar, etdrs or quali.
\item Either of \code{character} (for Snellen, Snellen decimal, and qualitative),
\code{numeric} (for logMAR), or \code{integer} (for ETDRS).
}
}

\examples{
## calling va without specifying "to" will clean visual acuity entries
## without conversion into another notation. Weird entries will be
## replaced by a missing value that R recognises as such
x <- c(23, "", NA, "N/A", "Not measured", "20/50", 74, 58)
va(x)

## ... or convert to snellen
va(x, to = "snellen")

## Dealing with those "plus/minus" entries, and qualitative values such as "HM"
va(c("NLP", "NPL", "PL", "LP", "HM", "CF", "6/60", "20/200", "6/9",
 "20/40", "20/40+3", "20/50-2"), to = "snellen")

## A mix of notations is also possible
x <- c("NLP", "0.8", "34", "3/60", "2/200", "20/40+3", "20/50-2")
va(x, to = "snellen")

## Any fraction is possible, and empty values
## change Snellen type to meter with type = "m"
x <- c("CF", "3/60", "2/200", "", "20/40+3", ".", "      ")
va(x, to = "snellen", type = "m")

}
\seealso{
Other Ophthalmic functions: 
\code{\link{va_mixed}()}

Other VA converter: 
\code{\link{VAwrapper}},
\code{\link{plausibility_methods}},
\code{\link{snellen_steps}},
\code{\link{va_methods}},
\code{\link{va_mixed}()},
\code{\link{which_va}()}

Other VA cleaner: 
\code{\link{clean_va}()}
}
\concept{Ophthalmic functions}
\concept{VA cleaner}
\concept{VA converter}
